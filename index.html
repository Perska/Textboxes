<!DOCTYPE html>
<body>

<canvas id="canvas" width="320" height="240" style="border: black 1px dotted">your browser stinky</canvas>
<textarea id="text"></textarea>
<button onclick="textIndex=0">Animate</button>
<img src="gohu14.bmp" id="font" style="background: black" onload="fontOK()">
<script>
Glyph = class {
	constructor(x,y,w,h) {
		this.x = x
		this.y = y
		this.w = w
		this.h = h
	}
}

textbox = document.getElementById("text")
canvas = document.getElementById("canvas")
scan = document.createElement("canvas")
context = canvas.getContext("2d")
_font = document.getElementById("font")
font = document.createElement("canvas")
ctx = font.getContext("2d")

function fontOK() {
	font.width = _font.width
	font.height = _font.height
	ctx.drawImage(_font,0,0)
}

textIndex = 0

function writeText() {
	textIndex=0;
}

function loop() {
	if (text.value.length>=textIndex) textIndex++
	context.clearRect(0,0,canvas.width,canvas.height)
	if (text.value[textIndex]=="¤" && text.value[textIndex+1]=="c") textIndex += 5
	drawString(text.value.substr(0,textIndex),4,4)
	requestAnimationFrame(loop)
}

function drawString(str,x,y) {
	var xPos = x
	var yPos = y
	var minY = 0
	var r = 0, g = 0, b = 0
	for (var i=0;i<str.length;i++) {
		chr = str[i]
		if (chr == "\n") {
			yPos += minY
			xPos = x
			minY = glyphs[32].h
			continue
		}
		if (chr == "¤") {
			if (str[i+1] == "c" && (str.length-i)>=4) {
				r = (str.charCodeAt(i + 2) - 48) / 9
				g = (str.charCodeAt(i + 3) - 48) / 9
				b = (str.charCodeAt(i + 4) - 48) / 9
				i += 4
				continue
			}
		}
		gl = glyphs[chr.charCodeAt()]
		put(gl.x,gl.y,gl.w,gl.h,xPos,yPos,r,g,b)
		xPos += gl.w
		minY = Math.max(gl.h,minY)
	}
}

function put(sx,sy,sw,sh,dx,dy,r,g,b) {	
	var data = ctx.getImageData(sx,sy,sw,sh); //copy one char from the font sheet
	// tint all the pixels
	for(var i=0;i<data.data.length;i+=4){
		data.data[i  ] *= r
		data.data[i+1] *= g
		data.data[i+2] *= b
	}
	// draw to the screen
	context.putImageData(data,dx,dy);
}


glyphs = {
	32: new Glyph(2,2,5,14), 33: new Glyph(12,2,3,14), 34: new Glyph(22,2,6,14), 35: new Glyph(32,2,8,14), 36: new Glyph(42,2,8,14), 37: new Glyph(52,2,8,14), 38: new Glyph(62,2,8,14), 39: new Glyph(72,2,4,14), 40: new Glyph(82,2,5,14), 41: new Glyph(92,2,5,14), 42: new Glyph(102,2,8,14), 43: new Glyph(112,2,8,14), 44: new Glyph(122,2,5,14), 45: new Glyph(132,2,8,14), 46: new Glyph(142,2,5,14), 47: new Glyph(152,2,8,14), 48: new Glyph(162,2,8,14), 49: new Glyph(172,2,8,14), 50: new Glyph(182,2,8,14), 51: new Glyph(192,2,8,14), 52: new Glyph(202,2,8,14), 53: new Glyph(212,2,8,14), 54: new Glyph(222,2,8,14), 55: new Glyph(232,2,8,14), 56: new Glyph(242,2,8,14), 57: new Glyph(252,2,8,14), 58: new Glyph(262,2,5,14), 59: new Glyph(272,2,5,14), 60: new Glyph(282,2,6,14), 61: new Glyph(292,2,7,14), 62: new Glyph(302,2,6,14), 63: new Glyph(312,2,8,14), 64: new Glyph(2,18,8,14), 65: new Glyph(12,18,7,14), 66: new Glyph(22,18,7,14), 67: new Glyph(32,18,7,14), 68: new Glyph(42,18,7,14), 69: new Glyph(52,18,7,14), 70: new Glyph(62,18,7,14), 71: new Glyph(72,18,7,14), 72: new Glyph(82,18,7,14), 73: new Glyph(92,18,4,14), 74: new Glyph(102,18,7,14), 75: new Glyph(112,18,7,14), 76: new Glyph(122,18,7,14), 77: new Glyph(132,18,8,14), 78: new Glyph(142,18,7,14), 79: new Glyph(152,18,7,14), 80: new Glyph(162,18,7,14), 81: new Glyph(172,18,7,14), 82: new Glyph(182,18,7,14), 83: new Glyph(192,18,7,14), 84: new Glyph(202,18,8,14), 85: new Glyph(212,18,7,14), 86: new Glyph(222,18,7,14), 87: new Glyph(232,18,8,14), 88: new Glyph(242,18,7,14), 89: new Glyph(252,18,8,14), 90: new Glyph(262,18,7,14), 91: new Glyph(272,18,4,14), 92: new Glyph(282,18,8,14), 93: new Glyph(292,18,4,14), 94: new Glyph(302,18,6,14), 95: new Glyph(312,18,8,14), 96: new Glyph(2,34,4,14), 97: new Glyph(12,34,7,14), 98: new Glyph(22,34,7,14), 99: new Glyph(32,34,7,14), 100: new Glyph(42,34,7,14), 101: new Glyph(52,34,7,14), 102: new Glyph(62,34,5,14), 103: new Glyph(72,34,7,14), 104: new Glyph(82,34,7,14), 105: new Glyph(92,34,4,14), 106: new Glyph(102,34,5,14), 107: new Glyph(112,34,7,14), 108: new Glyph(122,34,6,14), 109: new Glyph(132,34,8,14), 110: new Glyph(142,34,7,14), 111: new Glyph(152,34,7,14), 112: new Glyph(162,34,7,14), 113: new Glyph(172,34,7,14), 114: new Glyph(182,34,7,14), 115: new Glyph(192,34,7,14), 116: new Glyph(202,34,5,14), 117: new Glyph(212,34,7,14), 118: new Glyph(222,34,7,14), 119: new Glyph(232,34,8,14), 120: new Glyph(242,34,7,14), 121: new Glyph(252,34,7,14), 122: new Glyph(262,34,7,14), 123: new Glyph(272,34,8,14), 124: new Glyph(282,34,4,14), 125: new Glyph(292,34,8,14), 126: new Glyph(302,34,8,14), 160: new Glyph(312,34,5,14), 161: new Glyph(2,50,3,14), 162: new Glyph(12,50,8,14), 163: new Glyph(22,50,7,14), 164: new Glyph(32,50,8,14), 165: new Glyph(42,50,8,14), 166: new Glyph(52,50,3,14), 167: new Glyph(62,50,6,14), 168: new Glyph(72,50,5,14), 169: new Glyph(82,50,8,14), 170: new Glyph(92,50,6,14), 171: new Glyph(102,50,8,14), 172: new Glyph(112,50,7,14), 173: new Glyph(122,50,7,14), 174: new Glyph(132,50,8,14), 175: new Glyph(142,50,7,14), 176: new Glyph(152,50,5,14), 177: new Glyph(162,50,6,14), 178: new Glyph(172,50,5,14), 179: new Glyph(182,50,5,14), 180: new Glyph(192,50,3,14), 181: new Glyph(202,50,8,14), 182: new Glyph(212,50,8,14), 183: new Glyph(222,50,5,14), 184: new Glyph(232,50,5,14), 185: new Glyph(242,50,4,14), 186: new Glyph(252,50,6,14), 187: new Glyph(262,50,8,14), 188: new Glyph(272,50,8,14), 189: new Glyph(282,50,8,14), 190: new Glyph(292,50,8,14), 191: new Glyph(302,50,8,14), 192: new Glyph(312,50,7,14), 193: new Glyph(2,66,7,14), 194: new Glyph(12,66,7,14), 195: new Glyph(22,66,7,14), 196: new Glyph(32,66,7,14), 197: new Glyph(42,66,7,14), 198: new Glyph(52,66,8,14), 199: new Glyph(62,66,7,14), 200: new Glyph(72,66,7,14), 201: new Glyph(82,66,7,14), 202: new Glyph(92,66,7,14), 203: new Glyph(102,66,7,14), 204: new Glyph(112,66,4,14), 205: new Glyph(122,66,4,14), 206: new Glyph(132,66,4,14), 207: new Glyph(142,66,4,14), 208: new Glyph(152,66,8,14), 209: new Glyph(162,66,7,14), 210: new Glyph(172,66,7,14), 211: new Glyph(182,66,7,14), 212: new Glyph(192,66,7,14), 213: new Glyph(202,66,7,14), 214: new Glyph(212,66,7,14), 215: new Glyph(222,66,7,14), 216: new Glyph(232,66,7,14), 217: new Glyph(242,66,7,14), 218: new Glyph(252,66,7,14), 219: new Glyph(262,66,7,14), 220: new Glyph(272,66,7,14), 221: new Glyph(282,66,8,14), 222: new Glyph(292,66,7,14), 223: new Glyph(302,66,7,14), 224: new Glyph(312,66,7,14), 225: new Glyph(2,82,7,14), 226: new Glyph(12,82,7,14), 227: new Glyph(22,82,7,14), 228: new Glyph(32,82,7,14), 229: new Glyph(42,82,7,14), 230: new Glyph(52,82,8,14), 231: new Glyph(62,82,7,14), 232: new Glyph(72,82,7,14), 233: new Glyph(82,82,7,14), 234: new Glyph(92,82,7,14), 235: new Glyph(102,82,7,14), 236: new Glyph(112,82,4,14), 237: new Glyph(122,82,4,14), 238: new Glyph(132,82,4,14), 239: new Glyph(142,82,4,14), 240: new Glyph(152,82,7,14), 241: new Glyph(162,82,7,14), 242: new Glyph(172,82,7,14), 243: new Glyph(182,82,7,14), 244: new Glyph(192,82,7,14), 245: new Glyph(202,82,7,14), 246: new Glyph(212,82,7,14), 247: new Glyph(222,82,8,14), 248: new Glyph(232,82,8,14), 249: new Glyph(242,82,7,14), 250: new Glyph(252,82,7,14), 251: new Glyph(262,82,7,14), 252: new Glyph(272,82,7,14), 253: new Glyph(282,82,7,14), 254: new Glyph(292,82,7,14), 255: new Glyph(302,82,7,14)
}

requestAnimationFrame(loop)

</script>
</body>